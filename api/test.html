<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpinoCare API Test Console</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .status-banner {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .status-banner h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-weight: 600;
            color: #333;
        }

        .status-value {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .status-online {
            background: #10b981;
            color: white;
        }

        .status-offline {
            background: #ef4444;
            color: white;
        }

        .test-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .test-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .test-description {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .test-input {
            grid-column: span 2;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
            font-size: 0.9em;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Courier New', monospace;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .response-box {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .response-box pre {
            margin: 0;
            color: #333;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .success {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .endpoint-badge {
            display: inline-block;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .quick-actions button {
            flex: 1;
            min-width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• SpinoCare API Test Console</h1>

        <!-- Status Banner -->
        <div class="status-banner">
            <h2>System Status</h2>
            <div class="status-item">
                <span class="status-label">API Health:</span>
                <span id="api-status" class="status-value status-offline">Checking...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Base URL:</span>
                <span class="status-value" style="background: #f3f4f6; color: #333; font-family: monospace;">http://192.168.0.101/spinocare-api/</span>
            </div>
        </div>

        <!-- Test 1: Register User -->
        <div class="test-section">
            <h3>1Ô∏è‚É£ Register User</h3>
            <div class="endpoint-badge">POST /users/register</div>
            <p class="test-description">Create or update a user account linked to Firebase UID</p>
            
            <div class="test-grid">
                <div>
                    <label>Firebase UID:</label>
                    <input type="text" id="register-uid" value="test_firebase_uid_123" />
                </div>
                <div>
                    <label>Email:</label>
                    <input type="email" id="register-email" value="test@example.com" />
                </div>
                <div>
                    <label>Display Name:</label>
                    <input type="text" id="register-name" value="Test User" />
                </div>
                <div>
                    <label>Phone (Optional):</label>
                    <input type="text" id="register-phone" value="+1234567890" />
                </div>
            </div>
            
            <button onclick="registerUser()">üöÄ Register User</button>
            <div id="register-response" class="response-box" style="display:none;">
                <pre></pre>
            </div>
        </div>

        <!-- Test 2: Get User -->
        <div class="test-section">
            <h3>2Ô∏è‚É£ Get User Details</h3>
            <div class="endpoint-badge">GET /users/{firebase_uid}</div>
            <p class="test-description">Retrieve user information by Firebase UID</p>
            
            <div>
                <label>Firebase UID:</label>
                <input type="text" id="get-user-uid" value="test_firebase_uid_123" />
            </div>
            
            <button onclick="getUser()">üîç Get User</button>
            <div id="get-user-response" class="response-box" style="display:none;">
                <pre></pre>
            </div>
        </div>

        <!-- Test 3: Save Analysis -->
        <div class="test-section">
            <h3>3Ô∏è‚É£ Save MRI Analysis</h3>
            <div class="endpoint-badge">POST /analysis/save</div>
            <p class="test-description">Save analysis result with Firebase Storage image URLs</p>
            
            <div class="test-grid">
                <div>
                    <label>Firebase UID:</label>
                    <input type="text" id="analysis-uid" value="test_firebase_uid_123" />
                </div>
                <div>
                    <label>Entry ID:</label>
                    <input type="text" id="analysis-entry-id" value="entry_001" />
                </div>
                <div class="test-input">
                    <label>T1 Image URL:</label>
                    <input type="text" id="analysis-t1" value="https://firebasestorage.googleapis.com/.../t1_sample.jpg" />
                </div>
                <div class="test-input">
                    <label>T2 Image URL:</label>
                    <input type="text" id="analysis-t2" value="https://firebasestorage.googleapis.com/.../t2_sample.jpg" />
                </div>
                <div>
                    <label>Result:</label>
                    <select id="analysis-result">
                        <option value="No Modic Changes">No Modic Changes</option>
                        <option value="Modic Change Detected">Modic Change Detected</option>
                    </select>
                </div>
                <div>
                    <label>Confidence (0.0 - 1.0):</label>
                    <input type="number" id="analysis-confidence" value="0.9970" step="0.0001" min="0" max="1" />
                </div>
                <div>
                    <label>Mode:</label>
                    <select id="analysis-mode">
                        <option value="offline">Offline</option>
                        <option value="online">Online</option>
                    </select>
                </div>
                <div>
                    <label>Model Version:</label>
                    <input type="text" id="analysis-version" value="v1.0" />
                </div>
            </div>
            
            <button onclick="saveAnalysis()">üíæ Save Analysis</button>
            <div id="save-analysis-response" class="response-box" style="display:none;">
                <pre></pre>
            </div>
        </div>

        <!-- Test 4: Get Analysis List -->
        <div class="test-section">
            <h3>4Ô∏è‚É£ Get User's Analyses</h3>
            <div class="endpoint-badge">GET /analysis/list/{firebase_uid}</div>
            <p class="test-description">Retrieve all analyses for a user (paginated)</p>
            
            <div class="test-grid">
                <div>
                    <label>Firebase UID:</label>
                    <input type="text" id="list-uid" value="test_firebase_uid_123" />
                </div>
                <div>
                    <label>Limit:</label>
                    <input type="number" id="list-limit" value="10" />
                </div>
            </div>
            
            <button onclick="getAnalysisList()">üìã Get Analyses</button>
            <div id="list-response" class="response-box" style="display:none;">
                <pre></pre>
            </div>
        </div>

        <!-- Test 5: Get Specific Analysis -->
        <div class="test-section">
            <h3>5Ô∏è‚É£ Get Specific Analysis</h3>
            <div class="endpoint-badge">GET /analysis/{entry_id}</div>
            <p class="test-description">Retrieve a single analysis by entry ID</p>
            
            <div>
                <label>Entry ID:</label>
                <input type="text" id="get-analysis-id" value="entry_001" />
            </div>
            
            <button onclick="getAnalysis()">üîé Get Analysis</button>
            <div id="get-analysis-response" class="response-box" style="display:none;">
                <pre></pre>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="test-section">
            <h3>‚ö° Quick Actions</h3>
            <div class="quick-actions">
                <button onclick="runAllTests()">üß™ Run All Tests</button>
                <button onclick="clearAllResponses()">üóëÔ∏è Clear Responses</button>
                <button onclick="openPhpMyAdmin()">üóÑÔ∏è Open phpMyAdmin</button>
            </div>
        </div>
    </div>

    <script>
    const API_BASE = 'http://192.168.0.101/spinocare-api/index.php';

        // Check API health on load
        window.onload = checkHealth;

        async function checkHealth() {
            try {
                const response = await fetch(API_BASE);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('api-status').textContent = '‚úÖ Online';
                    document.getElementById('api-status').className = 'status-value status-online';
                } else {
                    document.getElementById('api-status').textContent = '‚ùå Error';
                    document.getElementById('api-status').className = 'status-value status-offline';
                }
            } catch (error) {
                document.getElementById('api-status').textContent = '‚ùå Offline';
                document.getElementById('api-status').className = 'status-value status-offline';
            }
        }

        async function registerUser() {
            const data = {
                firebase_uid: document.getElementById('register-uid').value,
                email: document.getElementById('register-email').value,
                display_name: document.getElementById('register-name').value,
                phone_number: document.getElementById('register-phone').value
            };

            await makeRequest('POST', '/users/register', data, 'register-response');
        }

        async function getUser() {
            const uid = document.getElementById('get-user-uid').value;
            await makeRequest('GET', `/users/${uid}`, null, 'get-user-response');
        }

        async function saveAnalysis() {
            const data = {
                firebase_uid: document.getElementById('analysis-uid').value,
                entry_id: document.getElementById('analysis-entry-id').value,
                t1_image_url: document.getElementById('analysis-t1').value,
                t2_image_url: document.getElementById('analysis-t2').value,
                analysis_result: document.getElementById('analysis-result').value,
                confidence: parseFloat(document.getElementById('analysis-confidence').value),
                analysis_mode: document.getElementById('analysis-mode').value,
                model_version: document.getElementById('analysis-version').value,
                processing_time_ms: Math.floor(Math.random() * 2000) + 500
            };

            await makeRequest('POST', '/analysis/save', data, 'save-analysis-response');
        }

        async function getAnalysisList() {
            const uid = document.getElementById('list-uid').value;
            const limit = document.getElementById('list-limit').value;
            await makeRequest('GET', `/analysis/list/${uid}?limit=${limit}`, null, 'list-response');
        }

        async function getAnalysis() {
            const id = document.getElementById('get-analysis-id').value;
            await makeRequest('GET', `/analysis/${id}`, null, 'get-analysis-response');
        }

        async function makeRequest(method, endpoint, data, responseElementId) {
            const responseBox = document.getElementById(responseElementId);
            const responsePre = responseBox.querySelector('pre');
            
            responseBox.style.display = 'block';
            responsePre.textContent = '‚è≥ Loading...';
            responseBox.className = 'response-box';

            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                // Build URL - endpoint already includes leading slash
                const url = API_BASE + '?path=' + encodeURIComponent(endpoint.substring(1));
                const response = await fetch(url, options);
                const result = await response.json();

                responsePre.textContent = JSON.stringify(result, null, 2);
                
                if (result.success) {
                    responseBox.classList.add('success');
                } else {
                    responseBox.classList.add('error');
                }
            } catch (error) {
                responsePre.textContent = `‚ùå Error: ${error.message}\n\nMake sure:\n1. XAMPP Apache is running\n2. Files are in C:/xampp/htdocs/spinocare-api/\n3. Database exists and has tables`;
                responseBox.classList.add('error');
            }
        }

        async function runAllTests() {
            await registerUser();
            await new Promise(r => setTimeout(r, 500));
            await getUser();
            await new Promise(r => setTimeout(r, 500));
            await saveAnalysis();
            await new Promise(r => setTimeout(r, 500));
            await getAnalysisList();
            await new Promise(r => setTimeout(r, 500));
            await getAnalysis();
        }

        function clearAllResponses() {
            document.querySelectorAll('.response-box').forEach(box => {
                box.style.display = 'none';
                box.className = 'response-box';
            });
        }

        function openPhpMyAdmin() {
            window.open('http://localhost/phpmyadmin', '_blank');
        }
    </script>
</body>
</html>
